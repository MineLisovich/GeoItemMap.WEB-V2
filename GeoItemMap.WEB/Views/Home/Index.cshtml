
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<style>
    #YMapsID {
        width: 100%;
        height: 100%;
        padding: 0;
        margin: 0;
    }
</style>
<script type="text/javascript">
    ymaps.ready(function () {
        var myMap = new ymaps.Map(
            "YMapsID",
            {
                center: [53.90, 27.56],
                zoom: 1,
                controls: []
            },
            {
                maxZoom: 17,
                restrictMapArea: [
                    [58.486077093111334, 15.89679288089655],
                    [49.77185323695446, 39.58331354601873]
                ]
            });
  
        // Загрузим регионы.
        ymaps.borders.load('001', {
            lang: 'ru',
            quality: 2
        }).then(function (result) {

            // Создадим многоугольник, который будет скрывать весь мир, кроме заданной страны.
            var background = new ymaps.Polygon([
                [
                    [85, -179.99],
                    [85, 179.99],
                    [-85, 179.99],
                    [-85, -179.99],
                    [85, -179.99]
                ]
            ], {}, {
                fillColor: '#B0B0B0',
                fillOpacity: 0.5,
                strokeWidth: 1.5,
                coordRendering: 'straightPath'
            });
            // Найдём страну по её iso коду.
            var region = result.features.filter(function (feature) { return feature.properties.iso3166 == 'BY'; })[0];
            var masks = region.geometry.coordinates;
            masks.forEach(function (mask) {
                background.geometry.insert(1, mask);
            });
            // Добавим многоугольник на карту.
            myMap.geoObjects.add(background);
        })

        // создание кластера
        clusterer = new ymaps.Clusterer({
            // Макет метки кластера pieChart.
            clusterIconLayout: 'default#pieChart',
            // Радиус диаграммы в пикселях.
            clusterIconPieChartRadius: 25,
            // Радиус центральной части макета.
            clusterIconPieChartCoreRadius: 10,
            // Ширина линий-разделителей секторов и внешней обводки диаграммы.
            clusterIconPieChartStrokeWidth: 3,
            // Определяет наличие поля balloon.
            hasBalloon: true
        });

        var circleLayout = ymaps.templateLayoutFactory.createClass('<div class="o-icon"><div class="parks-process-small"></div></div>');
        // получение координат для меток из бд
        $.ajax({
            url: 'https://localhost:7215/Home/GetCoordinates',
            type: 'POST',
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            async: true,
            success: function (result) {
                  //console.log(result)
                result.geoItems.forEach(element => {
                    // Технопарки
                    if (element.geoType == 0) {
                        var myGeoObject = new ymaps.GeoObject({
                            geometry: {
                                type: "Point", // тип геометрии - точка
                                coordinates: [element.x, element.y], // координаты точки
                            },
                        }, {
                                 //iconColor: "#33FF00"
                            iconLayout: circleLayout,
                           //iconImageHref: '../../icons/parks-actual.png',
                           //iconImageSize: [38, 38],
                           pane:'overlaps',
                           iconImageOffset: [0, 0],
                        });
                    }
                    //Центр трансфера технологий
                    if (element.geoType == 1) {
                        var myGeoObject = new ymaps.GeoObject({
                            geometry: {
                                type: "Point", // тип геометрии - точка
                                coordinates: [element.x, element.y], // координаты точки
                            },
                        }, {
                            iconColor: "#5863FF"
                        });
                    }
                    // ИНН проекты
                    if (element.geoType == 2) {
                        var myGeoObject = new ymaps.GeoObject({
                            geometry: {
                                type: "Point", // тип геометрии - точка
                                coordinates: [element.x, element.y], // координаты точки
                            },
                        }, {
                            iconColor: "#FF0000"
                        });
                    }
                    //НТП
                    if (element.geoType == 3) {
                        var myGeoObject = new ymaps.GeoObject({
                            geometry: {
                                type: "Point", // тип геометрии - точка
                                coordinates: [element.x, element.y], // координаты точки
                            },
                        }, {
                            iconColor: "#FFA158"
                        });
                    }
                    //Можно менять опции кластеризатора после создания.
                    clusterer.options.set({
                        gridSize: 100,
                        clusterDisableClickZoom: false
                    });

                    clusterer.add(myGeoObject);
                    myMap.geoObjects.add(clusterer);

                    myMap.setBounds(clusterer.getBounds(), {
                        checkZoomRange: true
                    });

                    myGeoObject.events.add('click', function () {

                        // Технопарки
                        if (element.geoType == 0) {
                            var url = "@Url.Action("GetPartialTechParck", "Home")";
                            var wrapperid = "#window-container";
                            AjaxAxtion(url, element.id, wrapperid);
                        }

                        //Центр трансфера технологий
                        if (element.geoType == 1) {
                            var url = "@Url.Action("GetPartialCTT", "Home")";
                            var wrapperid = "#window-container";
                            AjaxAxtion(url, element.id, wrapperid);
                        }

                        // ИНН проекты
                        if (element.geoType == 2) {
                            var url = "@Url.Action("GetPartialInnProject", "Home")";
                            var wrapperid = "#window-container";
                            AjaxAxtion(url, element.id, wrapperid);
                        }
                        //НТП
                        if (element.geoType == 3) {
                            var url = "@Url.Action("GetPartialNtpProject", "Home")";
                            var wrapperid = "#window-container";
                            AjaxAxtion(url, element.id, wrapperid);
                        }

                    });

                    function AjaxAxtion(url, id, wrapperid) {

                        $.ajax({
                            cache: false,
                            type: "GET",
                            url: url,
                            data: { id: id },
                            dataType: "html",
                            success: function (data) {
                                $(wrapperid).empty();
                                $(wrapperid).append(data);
                                top_popup();
                            },
                            error: function (xhr, ajaxOptions, thrownError) {
                                alert('Ошибка загрузки таблицы!');
                            }
                        });

                    }
                    // фильтрация меток
                    $(document).ready(function () {
                        const $srtBTN_tech = $("#filtr_teh_ctt_bif");
                        $srtBTN_tech.click(function () {
                            clusterer.add(myGeoObject);
                            myMap.geoObjects.add(clusterer);
                            if ($('#filtr_techparck').is(':checked')) {


                                if (element.geoType != 0) {
                                    clusterer.remove(myGeoObject);
                                }

                            }
                            if ($('#filtr_ctt').is(':checked')) {


                                if (element.geoType != 1) {
                                    clusterer.remove(myGeoObject);
                                }
                            }
                            if ($('#filtr_techparck').is(':checked') && $('#filtr_ctt').is(':checked')) {
                                clusterer.add(myGeoObject);
                                myMap.geoObjects.add(clusterer);
                                if (element.geoType != 0 && element.geoType != 1) {
                                    clusterer.remove(myGeoObject);
                                }
                            }

                            if (!$('#filtr_techparck').is(':checked') && !$('#filtr_ctt').is(':checked') && !$('#filtr_bif').is(':checked')) {
                                clusterer.add(myGeoObject);
                                myMap.geoObjects.add(clusterer);
                            }
                            //filtr_bif
                        });
                    });
                });
            }
        });
    });// КОНЕЦ СОЗДАНИИ КАРТЫ

 // При нажатии на вкладку "Субъекты инновационной инфраструктуры"
    $(document).ready(function () {
        const $showDataItem_techpar_ctt = $("#Item_techparck_ctt");
        $showDataItem_techpar_ctt.click(function () {
            let hasClass = $('.sidebarmap-accordion_item').hasClass('active_block');
            $("#info_object_Inn").empty();
            $("#info_object_ntp").empty();
            if (hasClass) {
                $.ajax({
                    url: 'https://localhost:7215/Home/PostData',
                    type: 'POST',
                    dataType: 'json',
                    contentType: 'application/json; charset=utf-8',
                    async: true,
                    success: function (result) {
                        //  console.log(result)
                        // Технопарки
                        result.technopark.forEach(itemTechnopark => { $("#info_object_tehnoparck_ctt").append(getInfoTechnopark(itemTechnopark)); })
                        // ЦТТ
                        result.techTransferCenter.forEach(itemTechTransferCenter => { $("#info_object_tehnoparck_ctt").append(getInfoTechTransferCenter(itemTechTransferCenter)); })
                    }
                });
                // Технопарк
                function getInfoTechnopark(itemTechnopark) {

                    return `
                                <a href="#" class="info_item">         
                                    <div class="info_item-icon parks-actual-big"></div>
                                    <div class="info_item-data item-header-js" data-type="tehParckHeader" data-id="${itemTechnopark.id}">
                                        <h3>${itemTechnopark.nameTechnopark}</h3>
                                        <span class="info_item-region">Республика</span>
                                   </div>
                                </a>
                        `;
                }
                // ЦТТ
                function getInfoTechTransferCenter(itemTechTransferCenter) {
                    return `
                               <a href="#" class="info_item">
                                    <div class="info_item-icon parks-actual-big"></div>
                                    <div class="info_item-data item-header-js" data-type="cctHeader" data-id="${itemTechTransferCenter.id}">
                                        <h3>${itemTechTransferCenter.nameTechTransferCenter}</h3>
                                        <span class="info_item-region">Республика</span>
                                   </div>
                              </a>
                          `;
                }

            }
            else {
                $('.sidebarmap-accordion_item').removeClass('active_block');
                $("#info_object_tehnoparck_ctt").empty();
            }


        });
    });
// При нажатии на вкладку "Инновационные проекты"
    $(document).ready(function () {
        const $showDataItem_inn = $("#Item_inn");
        $showDataItem_inn.click(function () {
            let hasClass = $('.sidebarmap-accordion_item').hasClass('active_block');
            $("#info_object_ntp").empty();
            $("#info_object_tehnoparck_ctt").empty();
            if (hasClass) {
                $.ajax({
                    url: 'https://localhost:7215/Home/PostData',
                    type: 'POST',
                    dataType: 'json',
                    contentType: 'application/json; charset=utf-8',
                    async: true,
                    success: function (result) {
                        //  console.log(result)
                        // ИНН
                        result.innProject.forEach(itemInnProject => { $("#info_object_Inn").append(getInfoInn(itemInnProject)); })
                    }
                });
                //ИНН
                function getInfoInn(itemInnProject) { 
                    return `
                                 <a href="#" class="info_item">
                                     <div class="info_item-icon parks-actual-big"></div>
                                     <div class="info_item-data item-header-js" data-type="InnHeader" data-id="${itemInnProject.id}">
                                        <h3>${itemInnProject.nameInnProject}</h3>
                                        <span class="info_item-region">Республика</span>
                                     </div>
                                 </a>
                            `;
                }
            }
            else {
                $('.sidebarmap-accordion_item').removeClass('active_block');
                $("#info_object_Inn").empty();
            }
        });
    });
 // При нажатии на вкладку "Научно-технологические  программы"
    $(document).ready(function () {
        const $showDataItem_ntp = $("#Item_ntp");
        $showDataItem_ntp.click(function () {
            let hasClass = $('.sidebarmap-accordion_item').hasClass('active_block');
            $("#info_object_Inn").empty();
            $("#info_object_tehnoparck_ctt").empty();
            // если меню открыто, то выполнить ajax запрос и подставить данные
            if (hasClass) {
                $.ajax({
                    url: 'https://localhost:7215/Home/PostData',
                    type: 'POST',
                    dataType: 'json',
                    contentType: 'application/json; charset=utf-8',
                    async: true,
                    success: function (result) {
                        //  console.log(result)
                        // НТП
                        result.ntpProject.forEach(itemNtpProject => { $("#info_object_ntp").append(getInfoNtp(itemNtpProject)); })
                    }
                });
                // НТП
                function getInfoNtp(itemNtpProject) { 
                    return `
                             <a href="#" class="info_item  item-header-js" data-type="NtpHeader" data-id="${itemNtpProject.id}">
                                <div class="info_item-icon parks-actual-big"></div>
                                <div class="info_item-data">
                                    <h3>${itemNtpProject.nameTask}</h3>
                                    <span class="info_item-region">Республика</span>
                               </div>
                             </a>
                                `;
                }
            }
            // При закртии меню происходит очистка div, чтобы избежать дублирования информации
            else {

                $('.sidebarmap-accordion_item').removeClass('active_block');
                $("#info_object_ntp").empty();
            }
        });
    });

 // всплывающего окна
 function top_popup() { 
            $(document).ready(function () { 
                const $closeWindow = $(".close-window");
                const $windowbar = $(".window");
                const $windowChild = $(".window-child");
                const $windowBlock = $(".window-block");
                const $buttonLeft = $(".window-side-button_left");
                const $childContainer = $(".window-child-container");
                const $closeBtn = $(".window-side-button");

                $windowbar.toggleClass("active");
                $windowChild.toggleClass("active");
                $windowBlock.removeClass("d-none");
                let hasClass = $('.window').hasClass('active');
                if (!hasClass)
                {
                   $("#window-container").empty();
                }

                $closeWindow.click(function () {
                    $windowbar.removeClass("active");
                    $windowChild.removeClass("active");
                $("#window-container").empty();
                  $windowBlock.toggleClass("d-none");
                });

                $closeBtn.click(function () {
                    $windowChild.animate({width: 300}, 250);
                    $buttonLeft.show();
                    $childContainer.show();
                });
               $buttonLeft.on('click',function(){
                    $windowChild.animate({width: 0}, 200);
                    $buttonLeft.hide();
                    $childContainer.hide();
              });
    });
   }

 // получение данных по id
    $(document).ready(function () {
        $('.sidebarmap').on('click', '.item-header-js', function () {
            var url = "";
            var wrapperid = "";
            var id = $(this).attr("data-id");

            switch ($(this).attr("data-type")) {
                case 'cctHeader':
                   url = "@Url.Action("GetPartialCTT", "Home")";
                   wrapperid = "#window-container";
                break;
                case 'tehParckHeader':
                    url = "@Url.Action("GetPartialTechParck", "Home")";
                    wrapperid = "#window-container";
                break;
                case 'InnHeader':
                    url = "@Url.Action("GetPartialInnProject", "Home")";
                    wrapperid = "#window-container";
                break;
                case 'NtpHeader':
                    url = "@Url.Action("GetPartialNtpProject", "Home")";
                    wrapperid = "#window-container";
                      
                break;
            }
            if (url != "") {
                AjaxAxtion(url, id, wrapperid);
            }
        });
        function AjaxAxtion(url, id, wrapperid) {

            $.ajax({
                cache: false,
                type: "GET",
                url: url,
                data: { id: id },
                dataType: "html",
                success: function (data)
                {
                    $(wrapperid).empty();
                    $(wrapperid).append(data);
                    top_popup();
                },
                error: function (xhr, ajaxOptions, thrownError)
                {
                    alert('Ошибка загрузки данных!');
                }
            });

            }
         });
</script>

<!-- map -->
<div id="YMapsID"></div>

<!-- end map -->




<!-- left sidebar map -->
    <div class="sidebarmap">
        <div class="sidebarmap-container">
            <!-- accordion -->
            <div class="sidebarmap-accordion">
                <!-- Субъекты инновационной инфраструктуры -->
                <section class="sidebarmap-accordion_item">
                    <h3 class="title_block" id="Item_techparck_ctt">
                        Субъекты инновационной <br> инфраструктуры
                    </h3>
                <div class="info">

                        <div class="info_panel" id="filtr_teh_ctt_bif">
                        <div class="info_panel-switchers d-flex justify-content-center">
                            <input type="checkbox" id="filtr_techparck">
                            <label for="filtr_techparck" style="border-bottom: 3px solid #3fab3c;">Технопарки</label>
                            <input type="checkbox" id="filtr_ctt">
                            <label for="filtr_ctt" style="border-bottom: 3px solid #ff9601;">ЦТТ</label>
                            <input type="checkbox" id="filtr_bif">
                            <label for="filtr_bif" style="border-bottom: 3px solid #9494b6">БИФ и НЦИС</label>
                        </div>
                        <div class="info_panel-filter">
                            <span class="filter-name">Регион</span>
                            <div class="mb-3">
                                <select class="form-select" id="small-select2-options-multiple-field" data-placeholder="Найти"
                                        placeholder="Выберите" multiple>
                                    <option>Минск</option>
                                    <option>Минская область</option>
                                    <option >Могилевская область</option>
                                    <option >Брестская область</option>
                                    <option>Гомельская область</option>
                                    <option >Гродненская область</option>
                                    <option>Витебская  область</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="sort-bar">
                        <span class="sort-icon"></span>
                        <span class="sort-button">Название</span>
                    </div>
                    <div class="info_object" id="info_object_tehnoparck_ctt">
                          
                    </div>
                    </div>
                </section>
                 <!--КОНЕЦ Субъекты инновационной инфраструктуры -->

                 <!-- Инновационные проекты -->
                <section class="sidebarmap-accordion_item">
                    <h3 class="title_block" id="Item_inn">Инновационные проекты</h3>
                    <div class="info">
                        <div class="info_panel" id="filt_inn">
                        <div class="info_panel-switchers d-flex justify-content-center">
                            <input type="checkbox" id="filtr_inn_end">
                            <label for="filtr_inn_end" style="border-bottom: 3px solid #3fab3c;">Завершен</label>
                            <input type="checkbox" id="filtr_inn_continues">
                            <label for="filtr_inn_continues" style="border-bottom: 3px solid #ff9601;">Продолжается</label>
                            <input type="checkbox" id="filtr_inn_execute">
                            <label for="filtr_inn_execute" style="border-bottom: 3px solid #9494b6">Выполнится</label>
                        </div>
                        <div class="info_panel-filter">
                            <span class="filter-name">Регион</span>
                            <div class="mb-3">
                                <select class="form-select" id="small-select2-options-multiple-field_inn" data-placeholder="Найти"
                                        placeholder="Выберите" multiple>
                                    <option>Минск</option>
                                    <option>Минская область</option>
                                    <option>Могилевская область</option>
                                    <option>Брестская область</option>
                                    <option>Гомельская область</option>
                                    <option>Гродненская область</option>
                                    <option>Витебская  область</option>
                                </select>
                            </div>
                        </div>
                        </div>

                    <div class="sort-bar">
                        <span class="sort-icon"></span>
                        <span class="sort-button" data-field="name">Название</span>
                    </div>

                        <!-- info_panel -->
                        <div class="info_object" id="info_object_Inn">

                        </div>
                    </div>
                    <!-- info -->
                </section>
                <!--КОНЕЦ Инновационные проекты -->

                <!--Научно-технологические программы -->
                <section class="sidebarmap-accordion_item">
                    <h3 class="title_block" id="Item_ntp">Научно-технологические <br> программы</h3>
                <div class="info">
                    <div class="info_panel" id="filtr_ntp">
                        <div class="info_panel-switchers d-flex justify-content-center">
                            <input type="checkbox" id="filtr_ntp_p1">
                            <label for="filtr_ntp_p1" style="border-bottom: 3px solid #3fab3c;">Программа 1</label>
                            <input type="checkbox" id="filtr_ntp_p2" >
                            <label for="filtr_ntp_p2" style="border-bottom: 3px solid #ff9601;">Программа 2</label>
                            <input type="checkbox" id="filtr_ntp_p3">
                            <label for="filtr_ntp_p3" style="border-bottom: 3px solid #9494b6">Программа 3</label>
                        </div>
                        <div class="info_panel-filter">
                            <span class="filter-name">Регион</span>
                            <div class="mb-3">
                                <select class="form-select" id="small-select2-options-multiple-field_ntp" data-placeholder="Найти"
                                        placeholder="Выберите" multiple>
                                    <option>Минск</option>
                                    <option>Минская область</option>
                                    <option>Могилевская область</option>
                                    <option>Брестская область</option>
                                    <option>Гомельская область</option>
                                    <option>Гродненская область</option>
                                    <option>Витебская  область</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="sort-bar">
                        <span class="sort-icon"></span>
                        <span class="sort-button">Название</span>
                    </div>
                    <!-- info_panel -->
                    <div class="info_object" id="info_object_ntp">

                    </div>
                </div>
            </section>
             <!--КОНЕЦ Научно-технологические программы -->
            </div>
            <!-- end accordion -->
        </div>

    </div>
<!-- end <!-- left sidebar map -->


    <!-- window -->
<div class="window-block d-none"></div>
    <div class="window">
        <div class="window-container" id="window-container">

         
       
       
        </div>
        <!-- window-container -->
    </div>
    <!-- end window -->

<!--  modal window for the gallery -->
   <script>
    function openModal() {
        document.getElementById("modal-gallery").style.display = "block";
        showSlides(slideIndex); // Показать первый слайд при открытии модального окна
    }

    function closeModal() {
        document.getElementById("modal-gallery").style.display = "none";
    }

    var slideIndex = 1;
    showSlides(slideIndex);

    function plusSlides(n) {
        showSlides(slideIndex += n);
    }

    function currentSlide(n) {
        showSlides(slideIndex = n);
    }

    function showSlides(n) {
        var i;
        var slides = document.getElementsByClassName("slides-gallery");
        var dots = document.getElementsByClassName("demo");
        var captionText = document.getElementById("caption");
        if (n > slides.length) {
            slideIndex = 1;
        }
        if (n < 1) {
            slideIndex = slides.length;
        }
        for (i = 0; i < slides.length; i++) {
            slides[i].style.display = "none";
        }
        for (i = 0; i < dots.length; i++) {
            dots[i].className = dots[i].className.replace(" active", "");
        }
        slides[slideIndex - 1].style.display = "block";
        dots[slideIndex - 1].className += " active";
        captionText.innerHTML = dots[slideIndex - 1].alt;
    }
   </script>
<!-- end modal window for the gallery -->



<!--navbar scripts-->
<script>
    //Сравнение
    function comparison_function() {
        document.getElementById("comparison-popup").classList.toggle("show_block");
        document.getElementById("comparison-tool").classList.toggle("show_background");
    }

    //О проекте
    function aboutProject() {
        document.getElementById("new-about-cont").classList.toggle("show_block");
        console.log("fwsfwsf")
    }

    //Закрыть окно О проекте
    $('.about_project_close_button').click(function () {
        document.getElementById("new-about-cont").classList.remove("show_block");
    }
    );


    //Инструменты
    function measurementTools() {
        document.getElementById("itsystem-measure-menu").classList.toggle("show_block");
    }

    window.onclick = function (event) {
        if (!event.target.matches('.itsystem-curr-lang')) {
            var dropdowns = document.getElementsByClassName("itsystem-lang-menu");
            var i;
            for (i = 0; i < dropdowns.length; i++) {
                var openDropdown = dropdowns[i];
                if (openDropdown.classList.contains('show_block')) {
                    openDropdown.classList.remove('show_block');
                }
            }
        }

        if (!event.target.matches('.itsystem-tool-button')) {
            var dropdowns = document.getElementsByClassName("itsystem-measure-menu");
            var i;
            for (i = 0; i < dropdowns.length; i++) {
                var openDropdown = dropdowns[i];
                if (openDropdown.classList.contains('show_block')) {
                    openDropdown.classList.remove('show_block');
                }
            }
        }
    }
</script>
<!-- end navbar scripts-->
